generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- ENUMS ---
enum PropertyCategory {
  APARTAMENTO
  CASA
  GALPAO
  SALA_COMERCIAL
  COBERTURA
  SITIO
  VEICULO
  HOTEL
  DIFERENCIADO
  EMBARCACAO
  TERRENO
}

enum TransactionType {
  VENDA
  LOCACAO
}

enum PropertyStatus {
  DISPONIVEL
  RESERVADO
  VENDIDO
  ALUGADO
}

// --- MODELO PRINCIPAL ---
model Property {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  badgeText  String? // Texto da tarja (Ex: "DECORADO CENTRO SUL")
  badgeColor String? // Cor Hexadecimal ou Enum (Ex: "#007bff" ou "BLUE")

  showOnSite  Boolean
  isExclusive Boolean

  buildingName String?

  // Infos Básicas
  title             String
  subtitle          String?
  category          PropertyCategory
  transactionType   TransactionType  @default(VENDA)
  exclusivityDocUrl String?

  acceptsTrade     Boolean @default(false) // Aceita permuta
  acceptsFinancing Boolean @default(false) // Aceita financiamento
  acceptsVehicle   Boolean @default(false)

  // Localização
  address   Address? @relation(fields: [addressId], references: [id])
  addressId Int?     @unique

  // Datas
  constructionStartDate DateTime?
  deliveryDate          DateTime?
  constructionStage     ConstructionStage? @default(PRONTO)

  // Numéricos
  bedrooms    Int @default(0)
  suites      Int @default(0)
  bathrooms   Int @default(0)
  garageSpots Int @default(0)

  registrationNumber String?

  // Áreas
  garageArea  Float?
  privateArea Float
  totalArea   Float?

  // Valores
  price     Decimal  @db.Decimal(15, 2)
  condoFee  Decimal? @db.Decimal(10, 2)
  iptuPrice Decimal? @db.Decimal(10, 2)

  // Textos
  description String?        @db.Text
  brokerNotes String?        @db.Text
  status      PropertyStatus @default(DISPONIVEL)

  // --- NOVOS RELACIONAMENTOS DE CARACTERÍSTICAS ---

  // Características da Unidade (ex: Mobiliado, Churrasqueira a carvão)
  propertyFeatures PropertyFeature[]

  // Características do Empreendimento (ex: Piscina, Academia, Cinema)
  developmentFeatures DevelopmentFeature[]

  // Outros Relacionamentos
  images            PropertyImage[]
  paymentConditions PaymentCondition[]
}

enum ConstructionStage {
  LANCAMENTO
  EM_OBRA
  PRONTO
}

// --- ENDEREÇO ---
model Address {
  id           Int     @id @default(autoincrement())
  state        String
  city         String
  neighborhood String
  street       String
  number       String
  complement   String?
  zipCode      String

  property Property?
}

// --- IMAGENS ---
model PropertyImage {
  id      Int     @id @default(autoincrement())
  url     String
  isCover Boolean @default(false)

  propertyId Int
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

// --- NOVAS TABELAS DE CARACTERÍSTICAS ---

// 1. Privativas (Do Imóvel)
model PropertyFeature {
  id         Int        @id @default(autoincrement())
  name       String     @unique
  properties Property[]
}

// 2. Comuns (Do Empreendimento)
model DevelopmentFeature {
  id         Int        @id @default(autoincrement())
  name       String     @unique
  properties Property[]
}

// --- CONDIÇÕES DE PAGAMENTO ---
model PaymentCondition {
  id          Int      @id @default(autoincrement())
  description String
  value       Decimal? @db.Decimal(15, 2)

  propertyId Int
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

// --- USUÁRIO (Auth) ---
model User {
  id        String   @id @db.Uuid
  email     String   @unique
  name      String?
  createdAt DateTime @default(now()) @map("created_at")
}
